<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"gaoxuefeng.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.27.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="我写了一个工具，让 AI 写代码终于像「我们团队的人」写的了 这篇文章介绍我开发的开源项目 AutoSnippet——一个代码模式知识库，让 Cursor、Copilot 等 AI 助手按你团队的规范生成代码。">
<meta property="og:type" content="article">
<meta property="og:title" content="AutoSnippet-将代码库中的模式提取为知识库">
<meta property="og:url" content="https://gaoxuefeng.com/posts/c6f37db">
<meta property="og:site_name" content="Gaoxuefeng&#39;s Blog">
<meta property="og:description" content="我写了一个工具，让 AI 写代码终于像「我们团队的人」写的了 这篇文章介绍我开发的开源项目 AutoSnippet——一个代码模式知识库，让 Cursor、Copilot 等 AI 助手按你团队的规范生成代码。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2026-02-08T17:42:37.000Z">
<meta property="article:modified_time" content="2026-02-22T15:25:05.223Z">
<meta property="article:author" content="gaoxuefeng">
<meta property="article:tag" content="iOS Swift JavaScript">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://gaoxuefeng.com/posts/c6f37db.html">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://gaoxuefeng.com/posts/c6f37db","path":"posts/c6f37db.html","title":"AutoSnippet-将代码库中的模式提取为知识库"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>AutoSnippet-将代码库中的模式提取为知识库 | Gaoxuefeng's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"WQkR0jDl5lLEcptvei9NmDR0-gzGzoHsz","app_key":"QIOxQpiKaIR8UafqIHm73OK0","server_url":""}</script>
  <script src="/js/third-party/statistics/lean-analytics.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Gaoxuefeng's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Gaoxuefeng's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%88%91%E5%86%99%E4%BA%86%E4%B8%80%E4%B8%AA%E5%B7%A5%E5%85%B7%EF%BC%8C%E8%AE%A9-AI-%E5%86%99%E4%BB%A3%E7%A0%81%E7%BB%88%E4%BA%8E%E5%83%8F%E3%80%8C%E6%88%91%E4%BB%AC%E5%9B%A2%E9%98%9F%E7%9A%84%E4%BA%BA%E3%80%8D%E5%86%99%E7%9A%84%E4%BA%86"><span class="nav-number">1.</span> <span class="nav-text">我写了一个工具，让 AI 写代码终于像「我们团队的人」写的了</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9AAI-%E5%86%99%E7%9A%84%E4%BB%A3%E7%A0%81%E3%80%8C%E8%83%BD%E8%B7%91%E3%80%8D%E4%BD%86%E3%80%8C%E4%B8%8D%E5%AF%B9%E5%91%B3%E3%80%8D"><span class="nav-number">1.1.</span> <span class="nav-text">问题：AI 写的代码「能跑」但「不对味」</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%EF%BC%9A%E6%8A%8A%E5%9B%A2%E9%98%9F%E7%9A%84%E3%80%8C%E6%9A%97%E7%9F%A5%E8%AF%86%E3%80%8D%E5%8F%98%E6%88%90-AI-%E8%83%BD%E6%9F%A5%E7%9A%84%E7%9F%A5%E8%AF%86%E5%BA%93"><span class="nav-number">1.2.</span> <span class="nav-text">思路：把团队的「暗知识」变成 AI 能查的知识库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E6%9D%A1%E5%91%BD%E4%BB%A4%E8%B7%91%E8%B5%B7%E6%9D%A5"><span class="nav-number">1.3.</span> <span class="nav-text">三条命令跑起来</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%83%E4%B8%8D%E5%8F%AA%E6%98%AF%E3%80%8C%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E3%80%8D"><span class="nav-number">1.4.</span> <span class="nav-text">它不只是「提示词工程」</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%9C%9F%E6%AD%A3%E7%90%86%E8%A7%A3%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. 真正理解代码结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%9B%9B%E5%B1%82%E6%A3%80%E7%B4%A2%EF%BC%8C%E4%B8%8D%E6%98%AF%E5%85%A8%E5%A1%9E%E8%BF%9B%E5%8E%BB"><span class="nav-number">1.4.2.</span> <span class="nav-text">2. 四层检索，不是全塞进去</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%9C%89-Token-%E9%A2%84%E7%AE%97%E6%8E%A7%E5%88%B6"><span class="nav-number">1.4.3.</span> <span class="nav-text">3. 有 Token 预算控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Guard-%E2%80%94%E2%80%94-%E8%A7%84%E8%8C%83%E4%B8%8D%E6%AD%A2%E8%A6%81%E5%BB%BA%E8%AE%AE%EF%BC%8C%E8%BF%98%E8%A6%81%E6%A3%80%E6%9F%A5"><span class="nav-number">1.4.4.</span> <span class="nav-text">4. Guard —— 规范不止要建议，还要检查</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IDE-%E6%B7%B1%E5%BA%A6%E9%9B%86%E6%88%90"><span class="nav-number">1.5.</span> <span class="nav-text">IDE 深度集成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Cursor"><span class="nav-number">1.5.1.</span> <span class="nav-text">Cursor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VS-Code-Copilot"><span class="nav-number">1.5.2.</span> <span class="nav-text">VS Code (Copilot)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Xcode"><span class="nav-number">1.5.3.</span> <span class="nav-text">Xcode</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dashboard-%E2%80%94%E2%80%94-%E4%B8%8D%E5%8F%AA%E6%98%AF%E4%B8%AA%E5%88%97%E8%A1%A8%E9%A1%B5"><span class="nav-number">1.6.</span> <span class="nav-text">Dashboard —— 不只是个列表页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.7.</span> <span class="nav-text">架构设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AI-Provider-%E6%94%AF%E6%8C%81"><span class="nav-number">1.8.</span> <span class="nav-text">AI Provider 支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%A8%E5%B9%B3%E5%8F%B0"><span class="nav-number">1.9.</span> <span class="nav-text">跨平台</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%92%8C%E7%8E%B0%E6%9C%89%E5%B7%A5%E5%85%B7%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.10.</span> <span class="nav-text">和现有工具的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9C%9F%E5%AE%9E%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.11.</span> <span class="nav-text">真实使用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="nav-number">1.12.</span> <span class="nav-text">写在最后</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="gaoxuefeng"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">gaoxuefeng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/GxFn" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;GxFn" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gaoxuefeng.com/posts/c6f37db">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="gaoxuefeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Gaoxuefeng's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="AutoSnippet-将代码库中的模式提取为知识库 | Gaoxuefeng's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AutoSnippet-将代码库中的模式提取为知识库
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-02-09 01:42:37" itemprop="dateCreated datePublished" datetime="2026-02-09T01:42:37+08:00">2026-02-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-02-22 23:25:05" itemprop="dateModified" datetime="2026-02-22T23:25:05+08:00">2026-02-22</time>
    </span>

  
    <span id="/posts/c6f37db" class="post-meta-item leancloud_visitors" data-flag-title="AutoSnippet-将代码库中的模式提取为知识库" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="我写了一个工具，让-AI-写代码终于像「我们团队的人」写的了"><a href="#我写了一个工具，让-AI-写代码终于像「我们团队的人」写的了" class="headerlink" title="我写了一个工具，让 AI 写代码终于像「我们团队的人」写的了"></a>我写了一个工具，让 AI 写代码终于像「我们团队的人」写的了</h1><blockquote>
<p>这篇文章介绍我开发的开源项目 <a target="_blank" rel="noopener" href="https://github.com/GxFn/AutoSnippet">AutoSnippet</a>——一个代码模式知识库，让 Cursor、Copilot 等 AI 助手按你团队的规范生成代码。</p>
</blockquote>
<span id="more"></span>

<hr>
<h2 id="问题：AI-写的代码「能跑」但「不对味」"><a href="#问题：AI-写的代码「能跑」但「不对味」" class="headerlink" title="问题：AI 写的代码「能跑」但「不对味」"></a>问题：AI 写的代码「能跑」但「不对味」</h2><p>用 Cursor 或 Copilot 写了大半年代码，我发现一个越来越严重的问题——<strong>AI 生成的代码永远不像我们团队写的</strong>。</p>
<p>命名风格不一样，错误处理的方式不一样，架构分层不一样，甚至 import 的顺序都不一样。它写出来的东西从技术上是对的，但放到代码库里一眼就能看出「这不是我们的人写的」。</p>
<p>结果就是两个选择：要么花时间重写 AI 的输出让它符合规范，要么在每次 Code Review 里反复解释同样的约定。时间长了，AI 带来的效率提升被改代码的成本吃掉了一大半。</p>
<p>我想解决这个问题。</p>
<h2 id="思路：把团队的「暗知识」变成-AI-能查的知识库"><a href="#思路：把团队的「暗知识」变成-AI-能查的知识库" class="headerlink" title="思路：把团队的「暗知识」变成 AI 能查的知识库"></a>思路：把团队的「暗知识」变成 AI 能查的知识库</h2><p>每个团队都有很多「心照不宣」的规范：</p>
<ul>
<li>网络请求统一用哪个封装？超时怎么设？</li>
<li>ViewModel 里状态管理用什么模式？</li>
<li>日志怎么打？错误怎么向上透传？</li>
<li>这个项目里 <code>Manager</code> 和 <code>Service</code> 的命名边界在哪？</li>
</ul>
<p>这些东西写在 Wiki 里没人看，写在 Code Review 评论里随着 PR 沉底，存在每个老员工的脑子里随时可能流失。</p>
<p><strong>AutoSnippet 做的事情就是：把这些知识从代码里提取出来，结构化存储，然后在 AI 写代码时自动喂给它。</strong></p>
<p>流程很简单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">你的代码 → AI 提取模式 → 你审核 → 知识库</span><br><span class="line">                                      ↓</span><br><span class="line">                        Cursor / Copilot / VS Code / Xcode</span><br><span class="line">                                      ↓</span><br><span class="line">                              AI 按你的规范生成代码</span><br></pre></td></tr></table></figure>

<h2 id="三条命令跑起来"><a href="#三条命令跑起来" class="headerlink" title="三条命令跑起来"></a>三条命令跑起来</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install -g autosnippet</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> your-project</span><br><span class="line">asd setup        <span class="comment"># 初始化工作空间 + 数据库 + IDE 配置</span></span><br><span class="line">asd coldstart    <span class="comment"># AI 扫描代码库，提取模式候选</span></span><br><span class="line">asd ui           <span class="comment"># 打开 Dashboard 审核</span></span><br></pre></td></tr></table></figure>

<p><code>asd setup</code> 会自动检测你装了哪些 IDE（Cursor、VS Code、Trae、Qoder），配好 MCP 连接。<code>asd coldstart</code> 会从 14 个维度扫描你的代码——架构模式、命名风格、设计模式、最佳实践、事件流、错误处理……扫描完生成一堆 <strong>Candidate</strong>（候选），等你审核。</p>
<p>打开 Dashboard，看到候选列表。每一条都是 AI 从你代码里提取出来的模式，有代码示例、使用说明、适用场景。你觉得好的，点通过，它就变成一条 <strong>Recipe</strong>（知识条目）进入知识库。觉得不好的就拒绝。</p>
<p>从此以后，IDE 里的 AI 写代码之前会先查你的 Recipe。</p>
<h2 id="它不只是「提示词工程」"><a href="#它不只是「提示词工程」" class="headerlink" title="它不只是「提示词工程」"></a>它不只是「提示词工程」</h2><p>我知道你在想什么——「这不就是把规范塞进 system prompt 吗」。不是的。</p>
<p>AutoSnippet 做的事情比往 prompt 里塞文本复杂得多：</p>
<h3 id="1-真正理解代码结构"><a href="#1-真正理解代码结构" class="headerlink" title="1. 真正理解代码结构"></a>1. 真正理解代码结构</h3><p>底层用 <strong>Tree-sitter</strong>（WASM 版本，不需要编译 C++）做 AST 解析，支持 9 种语言：JavaScript、TypeScript、Python、Swift、Objective-C、Java、Kotlin、Go、Ruby。不是正则匹配，是真的在解析语法树。</p>
<p>项目里有 11 个 Discoverer 自动识别项目类型（Node 项目、Flutter 项目、Spring 项目、Rust 项目……），还有 17 个 Enhancement Pack 针对具体框架（React、Vue、Next.js、Django、FastAPI、Spring、Android、Go gRPC、LangChain……）加上额外的分析逻辑。</p>
<h3 id="2-四层检索，不是全塞进去"><a href="#2-四层检索，不是全塞进去" class="headerlink" title="2. 四层检索，不是全塞进去"></a>2. 四层检索，不是全塞进去</h3><p>AI 问「网络请求怎么写」的时候，不是把整个知识库塞给它。搜索引擎有四层漏斗：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关键词匹配 → BM25 评分 → 语义向量重排 → 多信号融合排序</span><br></pre></td></tr></table></figure>

<p>先精确匹配，再语义理解，最后综合质量评分、使用频率、新鲜度等多个信号排出最相关的几条。支持中英文。</p>
<h3 id="3-有-Token-预算控制"><a href="#3-有-Token-预算控制" class="headerlink" title="3. 有 Token 预算控制"></a>3. 有 Token 预算控制</h3><p>AI 的上下文窗口是有限的。AutoSnippet 有一个 <code>KnowledgeCompressor</code>，会根据当前情况动态压缩知识内容，确保在 token 预算内塞进最有价值的信息，而不是简单地截断。</p>
<h3 id="4-Guard-——-规范不止要建议，还要检查"><a href="#4-Guard-——-规范不止要建议，还要检查" class="headerlink" title="4. Guard —— 规范不止要建议，还要检查"></a>4. Guard —— 规范不止要建议，还要检查</h3><p>提取出来的 Recipe 不仅用来「告诉 AI 怎么写」，还会衍生出 Guard 规则用来「检查代码有没有按规范写」。</p>
<p>Guard 引擎内置了 50+ 规则，涵盖：</p>
<ul>
<li><strong>正确性</strong>：ObjC <code>dispatch_sync(main queue)</code> 死锁、Swift <code>DispatchQueue.main.sync</code> 死锁</li>
<li><strong>安全性</strong>：<code>eval()</code>、SQL 注入、硬编码密钥</li>
<li><strong>性能</strong>：循环内的不必要分配、Dart 的 <code>setState</code> 调用</li>
<li><strong>风格</strong>：命名约定、代码组织方式</li>
</ul>
<p>可以接到 CI 流水线（<code>asd guard:ci</code>）和 git pre-commit hook（<code>asd guard:staged</code>），在代码合入前自动卡住不合规的。</p>
<h2 id="IDE-深度集成"><a href="#IDE-深度集成" class="headerlink" title="IDE 深度集成"></a>IDE 深度集成</h2><p>AutoSnippet 通过 <a target="_blank" rel="noopener" href="https://modelcontextprotocol.io/">MCP（Model Context Protocol）</a> 和 IDE 通信。MCP 是 Anthropic 推出的开放协议，让 AI 模型能够访问外部工具和数据。</p>
<p>共 16 个 MCP 工具：搜索知识库、浏览知识、Guard 检查、项目结构探查、知识创建、候选管理……IDE 里的 AI 可以按需调用这些工具。</p>
<h3 id="Cursor"><a href="#Cursor" class="headerlink" title="Cursor"></a>Cursor</h3><p>效果最好的 IDE。除了 MCP，还支持：</p>
<ul>
<li><strong>Cursor Rules</strong>——把 Recipe 摘要写入 <code>.cursor/rules/</code>，AI 自动遵守</li>
<li><strong>Agent Skills</strong>——20 个 Skill 包，AI 不只查知识库，还能扫描代码、创建候选、执行 Guard 检查</li>
<li><strong>自然语言驱动</strong>——在 Cursor 里直接说「帮我提取一下 network 模块的规范」，AI 会自动调 MCP 完成</li>
</ul>
<h3 id="VS-Code-Copilot"><a href="#VS-Code-Copilot" class="headerlink" title="VS Code (Copilot)"></a>VS Code (Copilot)</h3><p>MCP Server + 自研 VS Code 扩展，支持：</p>
<ul>
<li><strong>CodeLens</strong>——在代码上方直接显示关联的 Recipe</li>
<li><strong>文件指令</strong>——在代码里写 <code>// as:s network timeout</code> 自动搜索并插入相关知识</li>
<li><strong>保存时检查</strong>——保存文件自动触发 Guard 审计</li>
</ul>
<h3 id="Xcode"><a href="#Xcode" class="headerlink" title="Xcode"></a>Xcode</h3><p>通过 <code>asd watch</code> 文件监听实现，支持文件指令检测、代码片段同步。</p>
<h2 id="Dashboard-——-不只是个列表页"><a href="#Dashboard-——-不只是个列表页" class="headerlink" title="Dashboard —— 不只是个列表页"></a>Dashboard —— 不只是个列表页</h2><p><code>asd ui</code> 启动的 Dashboard 是一个功能完整的 Web 管理界面（React + Vite + Tailwind），包含：</p>
<ul>
<li><strong>Recipe 浏览器</strong>——搜索、过滤、查看完整知识条目</li>
<li><strong>Candidate 审核台</strong>——审核 AI 扫描出来的候选，通过&#x2F;拒绝&#x2F;编辑</li>
<li><strong>AI Chat</strong>——内置的 AI 对话，背后是一个 ReAct 推理引擎 + DAG 任务管线，支持 54 个内置工具</li>
<li><strong>知识图谱</strong>——可视化展示知识之间的关联关系</li>
<li><strong>Guard 报告</strong>——合规检查的可视化结果</li>
<li><strong>模块探查器</strong>——浏览项目的模块结构和依赖关系</li>
<li><strong>Wiki 生成</strong>——一键从知识库生成项目 Wiki</li>
<li><strong>LLM 配置</strong>——在界面上切换 AI Provider，不用改 <code>.env</code></li>
</ul>
<h2 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h2><p>我花了很多心思在架构上。采用分层领域驱动设计（Layered DDD）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">IDE 接入层       Cursor · VS Code · Trae · Qoder · Xcode · Dashboard</span><br><span class="line">                                     │</span><br><span class="line">                             MCP Server + HTTP API</span><br><span class="line">                                     │</span><br><span class="line">服务层           Search · Knowledge · Guard · Chat · Bootstrap · Wiki</span><br><span class="line">                                     │</span><br><span class="line">核心层           AST (9 lang) · KnowledgeGraph · RetrievalFunnel · QualityScorer</span><br><span class="line">                                     │</span><br><span class="line">基础设施层       SQLite · VectorStore · EventBus · AuditLog · DI Container (40+)</span><br></pre></td></tr></table></figure>

<p>几个我比较满意的设计决策：</p>
<ul>
<li><strong>Markdown 是真相来源</strong>——Recipe 存为 Markdown 文件，SQLite 只是读缓存。数据库坏了 <code>asd sync</code> 重建，但 Markdown 文件能直接看、直接改、直接进 Git</li>
<li><strong>无编译步骤</strong>——纯 JavaScript（ESM），不用 TypeScript 编译（Dashboard 除外）。Node.js ≥ 20 直接跑</li>
<li><strong>WASM AST</strong>——<code>web-tree-sitter</code> 替代原生 <code>tree-sitter</code>，彻底摆脱 C++ 编译依赖，<code>npm install</code> 就能用</li>
<li><strong>自研 DI 容器</strong>——40+ 服务的懒加载单例注入，不依赖任何外部 DI 框架。支持 AI Provider 热重载</li>
<li><strong>宪法系统（RBAC）</strong>——三层权限架构：能力层（运行时探测）、角色层（IDE AI &#x2F; 内置 AI &#x2F; 开发者）、治理层（4 条硬规则）。确保 AI 不会在没有你确认的情况下删除数据或发布内容</li>
</ul>
<h2 id="AI-Provider-支持"><a href="#AI-Provider-支持" class="headerlink" title="AI Provider 支持"></a>AI Provider 支持</h2><p>不绑定任何一家。支持 Google Gemini、OpenAI、Claude、DeepSeek、Ollama（本地）。配多个 Key 会自动 fallback——Gemini 挂了切 OpenAI，OpenAI 挂了切 DeepSeek。</p>
<p>甚至不配 AI 也能用——知识库本身不依赖 AI。你手动写 Recipe Markdown 文件，<code>asd sync</code> 进库，搜索和 Guard 照样工作。AI 只是让「从代码里提取模式」这一步自动化了。</p>
<h2 id="跨平台"><a href="#跨平台" class="headerlink" title="跨平台"></a>跨平台</h2><p>最初是 macOS Only（因为有 Xcode 功能），3.0.9 版本做了一次深度跨平台审计，修复了 7 处 macOS 专属依赖：</p>
<ul>
<li>剪贴板操作：macOS <code>pbcopy</code> &#x2F; Linux <code>wl-copy</code> + <code>xclip</code> &#x2F; Windows PowerShell</li>
<li>通知：macOS <code>osascript</code> &#x2F; Linux <code>notify-send</code> &#x2F; Windows UWP Toast</li>
<li>IDE 发现：三个平台各自的路径探测</li>
<li>路径解析：<code>readlink -f</code> → Node.js 原生 <code>fs.realpathSync()</code></li>
</ul>
<p>现在 macOS &#x2F; Linux &#x2F; Windows 都能用了（Xcode 功能除外）。</p>
<h2 id="和现有工具的区别"><a href="#和现有工具的区别" class="headerlink" title="和现有工具的区别"></a>和现有工具的区别</h2><table>
<thead>
<tr>
<th></th>
<th>AutoSnippet</th>
<th>ESLint &#x2F; Biome</th>
<th>.cursorrules 手写</th>
</tr>
</thead>
<tbody><tr>
<td>知识来源</td>
<td>AI 从代码提取 + 人工审核</td>
<td>手写规则</td>
<td>手写</td>
</tr>
<tr>
<td>覆盖范围</td>
<td>架构&#x2F;模式&#x2F;惯例&#x2F;最佳实践</td>
<td>语法&#x2F;格式</td>
<td>自由文本</td>
</tr>
<tr>
<td>维护方式</td>
<td>持续从代码演化</td>
<td>手动更新配置</td>
<td>手动更新文件</td>
</tr>
<tr>
<td>AI 交付</td>
<td>MCP 协议自动推送</td>
<td>不涉及 AI</td>
<td>仅限 Cursor</td>
</tr>
<tr>
<td>合规检查</td>
<td>Guard (正则 + AST)</td>
<td>有</td>
<td>无</td>
</tr>
<tr>
<td>多 IDE 支持</td>
<td>Cursor&#x2F;VS Code&#x2F;Trae&#x2F;Qoder&#x2F;Xcode</td>
<td>IDE 无关</td>
<td>仅 Cursor</td>
</tr>
</tbody></table>
<p><strong>AutoSnippet 不替代 ESLint</strong>，它们覆盖的层次不同。ESLint 管代码格式和语法规则，AutoSnippet 管「我们团队怎么写网络请求」「ViewModel 里状态怎么管」这种更高层的东西。</p>
<h2 id="真实使用场景"><a href="#真实使用场景" class="headerlink" title="真实使用场景"></a>真实使用场景</h2><p>我自己在几个项目上跑 AutoSnippet。举几个场景：</p>
<p><strong>场景一：新人入职</strong></p>
<p>新人 clone 代码后跑 <code>asd setup &amp;&amp; asd coldstart</code>，知识库自动建好了。在 Cursor 里写代码的时候，AI 直接按团队规范生成。以前新人需要一两周摸索的「团队暗知识」，现在第一天就能用上。</p>
<p><strong>场景二：大型重构</strong></p>
<p>重构前先 <code>asd guard:ci</code> 生成合规报告，看看哪些模块偏离了规范。重构过程中 Guard 实时检查，确保新代码符合模式。重构完再扫描一遍，把新模式沉淀进知识库。</p>
<p><strong>场景三：跨模块开发</strong></p>
<p>你要改一个不熟的模块。在 Cursor 里问「这个模块的错误处理规范是什么」，MCP 自动搜索知识库返回相关 Recipe，附带代码示例和使用指南。不用翻 Wiki，不用问人。</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>AutoSnippet 解决的核心问题是：<strong>AI 编码助手缺乏团队上下文</strong>。</p>
<p>它不是另一个 prompt 模板工具，而是一个完整的知识管理基础设施——从提取、审核、存储、检索到交付的全链路。</p>
<p>项目开源（MIT），欢迎试用和反馈：</p>
<ul>
<li><strong>GitHub</strong>: <a target="_blank" rel="noopener" href="https://github.com/GxFn/AutoSnippet">github.com&#x2F;GxFn&#x2F;AutoSnippet</a></li>
<li><strong>npm</strong>: <code>npm install -g autosnippet</code></li>
<li><strong>文档</strong>: 项目内 <code>docs/</code> 目录有完整的架构设计、CLI 参考、配置指南、IDE 集成说明</li>
</ul>
<p>如果你的团队也被 AI 生成代码「不合规范」困扰，试试看。三条命令就能跑起来。</p>
<hr>
<p><em>作者：gaoxuefeng</em><br><em>项目版本：v3.0.x</em><br><em>License: MIT</em></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/e3a4c4e5" rel="prev" title="枪炮、病菌与钢铁:人类社会的命运">
                  <i class="fa fa-angle-left"></i> 枪炮、病菌与钢铁:人类社会的命运
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">gaoxuefeng</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/GxFn" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"GxFn","repo":"GxFn.github.io","client_id":"Ov23lik56LzJylJIS1rq","client_secret":"5d8a021631cfc22a1f8d71b1108b55a3c264f13d","admin_user":"GxFn","distraction_free_mode":false,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"body":null,"id":"pathname","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"ea6f3092421e36a5a1e6b22684725f52"}</script>
<script src="/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
